define("post-controller",["zepto","res/post/js/mobile-share","res/post/js/mobile-wx-share"],function($,share,wx_share){var is_weixin=/micromessenger/gi.test(window.navigator.userAgent),d=SOHUZ.page,s=SOHUZ.share,c={share:function(){if(is_weixin){wx_share.share(s)}else{share.open(s)}},share_rollback:function(){share.hide($("#js-share-screen"))},set_read:function(id){$.ajax({url:"/platform/api/v1/posts/"+id+"/info",type:"PUT",dataType:"json",contentType:"application/json",data:JSON.stringify({type:"READ"}),success:function(d){}})},is_liked:function(id){var key="like-post-"+id,s=localStorage.getItem(key);return s==="1"}};s.url=window.location.href;s.scene_type=6;if(is_weixin){wx_share.init(s)}return c});require(["zepto","post-controller","res/post/js/sidebar","lib/mustache"],function($,controller,sidebar,mustache){$(function(){var post=$(".page-content"),page=SOHUZ.page,site_id=page.site_id,page_id=page.page_id;label_arr=page.label_arr,search=window.location.search,main=$("#phone-main"),html="",sohucs=post.find("#SOHUCS"),ad=post.find(".share-ad"),is_liked=controller.is_liked(page_id),is_mobile=/Android|webOS|iPhone|iPad|iPod|BlackBerry|BB|PlayBook|IEMobile|Windows Phone|Kindle|Silk|Opera Mini/i.test(navigator.userAgent);if(label_arr.length>0){var tpl='<div class="kz-label-layer">'+'<span class="k-i-art-span icon" ></span>'+"{{#label_arr}}"+'<a class="post-label" href="{{link}}">{{text}}</a>'+"{{/label_arr}}"+"</div>"+'<p class="cutting-line"></p>';html+=mustache.to_html(tpl,{label_arr:label_arr})}var readon=SOHUZ.read_on==="1"?"true":"";var likeon=SOHUZ.like_on==="1"?"true":"";var tpl='<xq-post-like-line pageid="'+page_id+'" readon="'+readon+'" likeon="'+likeon+'"></xq-post-like-line>';html+=mustache.to_html(tpl);if(ad.length>0){$(html).insertBefore(ad)}else if(sohucs.length>0){$(html).insertBefore(sohucs)}else{post.append(html)}if(is_mobile){var ly=0,float_bar=$(".mobile-float-bar"),has_changyan=sohucs.length>0;if(has_changyan){var try_times=0,clear=0;function get_comments(){if(try_times>3){clearTimeout(clear);return}var comments=0;clear=setTimeout(function(){if($("[node-type='comment-number']").length>0){comments=parseInt($("[node-type='comment-number']").text());comments=comments>1e4?"1ä¸‡+":comments;float_bar.find(".comment-num").text(comments)}else{get_comments();try_times++}},1e3)}get_comments()}function fadein(e){setTimeout(function(){e.removeClass("fadein")},600);e.addClass("fadein").show()}function fadeout(e){setTimeout(function(){e.hide().removeClass("fadeout")},600);e.addClass("fadeout")}$(window).on("scroll",function(){if(Math.abs(window.scrollY-ly)<20){return}var hided=float_bar.css("display")==="none";if(window.scrollY<ly){if(hided){fadein(float_bar)}}else{if(!hided){fadeout(float_bar)}}ly=window.scrollY});var last_time=0;post.on("click",".mod-html",function(ev){if(ev.target.tagName==="IMG"){return}var hided=float_bar.css("display")==="none",current_time=(new Date).getTime();if(current_time-last_time<600){last_time=current_time;return}if(hided){fadein(float_bar)}else{fadeout(float_bar)}last_time=current_time})}sidebar(main);main.on("click","[data-role='author']",function(){if(kaq){kaq("send","event","imported_post","click",$(this).attr("data-id"),1)}window.location=$(this).attr("data-url")}).on("click","[data-role='header-back']",function(){window.history.back()}).on("click","[data-role='comment']",function(){document.body.scrollTop=sohucs.offset().top}).on("click","[data-role='comment-input']",function(){window.changyan.api.openCmtBox()}).on("click","a[data-role=share]",function(){var ua=navigator.userAgent,share_info=SOHUZ.api.share_info(),is_ios=/KuaiZhaniOSSite/gi.test(ua),is_android=/KuaiZhanAndroidWrapper/gi.test(ua);if(is_ios||is_android){window.kzsdk.ready({readyCallback:function(){window.kzsdk.share({title:share_info.title,content:share_info.desc,link:share_info.url,logo:share_info.pic,trigger:true})},errorCallback:function(){controller.share()}})}else{controller.share()}if(kaq){kaq("send","event","post_share","click",page_id,1)}});setTimeout(function(){controller.set_read(page_id)},1e3);if(kaq){kaq("send","event","post_read","view",String(page.thirdpart),1)}if(search!=""){var query={};search.slice(1).split("&").map(function(e){var arr=e.split("=");if(arr.length===2){query[decodeURIComponent(arr[0])]=decodeURIComponent(arr[1])}});if(query.utm_source){$.get("//pv.kuaizhan.com/newInc?traceId=mpservice&traceKey="+query.utm_source,null)}}})});